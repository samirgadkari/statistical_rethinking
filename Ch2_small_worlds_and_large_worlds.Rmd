---
title: 'Ch2: Small Worlds and Large Worlds'
author: "Samir Gadkari"
date: "2/21/2021"
output: html_document
---

### 2.4.3 Grid Approximation

```{r}
p_grid <- seq(0, 1, length.out = 20) # probability grid

prior <- function(type) {
  if (type == 1L) {
    
    rep(1, 20)                   # First prior
  } else if (type == 2L) {
    
    ifelse(p_grid < 0.5, 0, 1)   # Second prior
  } else {
    
  exp(-5 * abs(p_grid - 0.5))    # Third prior
  }
}

# dbinom gives the density of the binomial distribution, given:
#   the number of successes
#   number of trials
#   the probability of success
likelihood <- dbinom(6,         # number of successes
                     size = 9,  # number of trials
                     prob = p_grid) # probability of success per trial

plot_posterior <- function(type) {
  # Unstandardized posterior distribution
  unstd.posterior <- prior(type) * likelihood
  
  # Standardize the posterior distribution
  posterior <- unstd.posterior / sum(unstd.posterior)
  
  plot(p_grid, posterior, 
       type = "b",   # 'p' : points, "l" : lines, "b" : both
       xlab = "probability of water",
       ylab = "posterior probability"
       )
  mtext("20 points")
}
```
```{r}
plot_prior <- function(p_grid, prior_type) {
  plot(p_grid, prior(prior_type), type = "b")
  mtext(paste("prior_type =", prior_type))
}
plot_likelihood <- function() {
  plot(p_grid, likelihood, type = "b")
}
```

```{r}
plot_likelihood()
plot_prior(p_grid, prior_type = 1)
plot_posterior(1)
plot_prior(p_grid, prior_type = 2)
plot_posterior(2)
plot_prior(p_grid, prior_type = 3)
plot_posterior(3)
```

To compute the quadratic approximation to the globe tossing posterior:
```{r}
library(rethinking)

globe.qa <- quap(alist(
                    W ~ dbinom(W + L, p), # binomial likelihood
                    p ~ dunif(0, 1)       # uniform prior
                  ),
                 data = list(W = 6, L = 3)
                )
precis(globe.qa)   # display summary of quadratic approximation
```

Posterior mean value = p = 0.67
Curvature of the quadratic approximation = sd = 0.16
89 percentile interval = [0.42, 0.92]

MCMC (Markov Chain Monte Carlo) approximation to the globe tossing 
posterior:
```{r}
n_samples <- 1000

p <- rep(NA, n_samples)
p[1] <- 0.5

W <- 6
L <- 3

for (i in 2:n_samples) {
  p_new <- rnorm(1, p[i - 1], 0.1)
  if (p_new < 0) p_new <- abs(p_new)
  if (p_new > 1) p_new <- 2 - p_new
  
  q0 <- dbinom(W, W + L, p[i - 1])
  q1 <- dbinom(W, W + L, p_new)
  
  p[i] <- ifelse(runif(1) < q1 / q0, p_new, p[i - 1])
}
```

The values from p are samples from the posterior. To compare with the
analytic posterior:
```{r}
dens(p, xlim = c(0, 1))
curve(dbeta(x, W + 1, L + 1), lty = 2, add = TRUE)
```

This is the Metropolis algorithm, and is explained in Chapter 9.
